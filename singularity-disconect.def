BootStrap: docker
From: python:3.6-slim

%environment
  export LC_ALL=en_US.UTF-8
  export LANG=en_US.UTF-8
  #export MATPLOTLIBRC="/usr/local/lib/python3.6/dist-packages/matplotlib/mpl-data/"

%post

 sed -i 's/main/main restricted universe/g' /etc/apt/sources.list
 apt update --fix-missing

 # Get dependencies
 apt-get update
 apt-get install -y --no-install-recommends \
   locales \
   ca-certificates \
   build-essential \
   libgl1-mesa-dev \
   libsm6 \
   libxext6 \
   libxrender-dev \
   libglib2.0-0 \
   python3-tk \
   unzip \
   wget \
   libblas-dev liblapack-dev

 # Configure default locale
 echo "en_US.UTF-8 UTF-8" >> /etc/locale.gen
 locale-gen en_US.utf8
 /usr/sbin/update-locale LANG=en_US.UTF-8
 export LC_ALL=en_US.UTF-8
 export LANG=en_US.UTF-8

 rm -rf /var/lib/apt/lists/*
 rm -rf /var/cache/apt/*.bin

 cd /
 wget https://github.com/scilus/scilpy/archive/master.zip
 unzip master.zip
 mv scilpy-master scilpy
 cd /scilpy
 pip3.6 install -r requirements.txt --no-cache
 pip3.6 freeze
 python3.6 setup.py build_ext --inplace
 python3.6 setup.py install
 python3.6 setup.py install_scripts


 #sed -i '41s/.*/backend : Agg/' /usr/local/lib/python3.6/dist-packages/matplotlib/mpl-data/matplotlibrc
